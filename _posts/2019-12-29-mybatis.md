# mybatis

```java
//加载xml配置
InputStream is=Resources.getResourcAsStream("mybatis.xml");
SqlSessionFactory factory=new  SqlSessionFactoryBuilder().build(is);
```







```xml
<resultMap id="user_map" type="User">
    <result column="id" property="id"></result>
    一对一映射配置
    <association property="javabean的成员属性" javaType="变量类型">
        <id column="" property=""></id>
        <result column="" property=""></result>
	</association>
    一对多 collection
    
    <colection property="多的一方成员变量名" >
        
    </colection>
</resultMap>
可继承
<resultMap id="" type="" extends="user_map">
    
</resultMap>
<select id="queryId" parameterType="int" resultMap="user_map">
	select * from user where id=#{uid}
</select>
```











不使用xml配置

注解

```java
public interface UserDao{
    @select("sql语句")
    public User queryId(Integer id);
}
	@Test
	public void test(){
        InputStream is=Resources.getResourceAsStream("mybatis.xml");
        SqlSessionFactory factory=new SqlSessionFactoryBuilder().build(is);
        SqkSession session=factory.openSession();
        UserDao userDaoProxy =session.getMapper(UserDao.class);
      	userDaoProxy.queryId(1);
        session.close();
    }
```







#### 接口代理实现CRUD规范

sql 

#### 返回主键

#### mysql

```xml
<insert>
    <selectKey order="after">
        select last_insert_id()
    </selectKey>
    sql语句
</insert>
```

oracle 

```xml
<selectKey keyProperty="id">
    select xxxSequense.nextVal() from dual
</selectKey>
```

#### 批量操作

###### allowMultiQueries=true

##### 添加

```xml
<insert id="">
    insert into table() values 
    <foreach collection="list/array/ids(map)?" item="i" separator=",">
        
    </foreach>
</insert>
```

#### 动态sql

##### 标签配置

if 

where

choose  when otherwise

trim

set

foreach

```xml
<trim prefix="where" prefixOverrides="and|or">前后缀
</trim>
```

##### 注解配置

@Insert("sql")  @Update @Select @ Delete

@InsertProvider(type=".class",method="query")

class provider{

​	public  void query(){

​				return new SQL(){

​						{ 

​							SELECT:""

​							FROM:""

​							WHERE:""

​										if(){

​												where

​											}

​						}

​				}

​				

​	} 

}







缓存

一级 同一个session内 会话期间有效 默认开启 基于内存

二级 同一个namespace内 进程级别缓存 不同线程可以共享 基于内存+硬盘

 		1.mybatis.xml 开启开关

```xml
<setting name="cacheEnabled" value="true"></setting>
```



​		2.对象序列化

​		3.指定命名空间下开启		

​			添加标签

```xml
<cache type="默认为框架自身实现的PerpetuaCache/ehcache" value="true"></cache>
```



​	

